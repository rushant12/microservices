import com.bettercloud.vault.Vault;
import com.bettercloud.vault.VaultConfig;
import com.bettercloud.vault.response.AuthResponse;
import com.bettercloud.vault.response.LogicalResponse;

import java.util.Map;

public class VaultClient {

    public static void main(String[] args) {
        try {
            // Vault Configuration
            String vaultUrl = "https://vault-public-vault-75e984b5.bdecd756.z1.hashicorp.cloud:8200";
            String username = "espire_dev";
            String password = "Dev+Cred4#";
            String secretPath = "Store_Dev/10099"; // Adjusted path
            String namespace = "admin/espire";

            // Initialize Vault configuration
            VaultConfig config = new VaultConfig()
                    .address(vaultUrl)
                    .build();

            Vault vault = new Vault(config);

            // Authenticate using Userpass
            AuthResponse authResponse = vault.auth().loginByUserPass(username, password, "userpass");
            String token = authResponse.getAuthClientToken();

            // Read secret from Vault
            LogicalResponse response = vault.logical()
                    .withHeader("X-Vault-Token", token)
                    .withHeader("X-Vault-Namespace", namespace)
                    .read("v1/" + secretPath);

            // Extract and print secret data
            Map<String, String> data = response.getData();
            String secretValue = data.get("password"); // Assuming 'password' is the key
            System.out.println("Retrieved secret: " + secretValue);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
