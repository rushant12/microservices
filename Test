import com.bettercloud.vault.Vault;
import com.bettercloud.vault.VaultConfig;
import com.bettercloud.vault.response.AuthResponse;
import com.bettercloud.vault.response.LogicalResponse;

import java.util.Map;

public class VaultClient {

    public static void main(String[] args) {
        try {
            String vaultUrl = "https://vault-public-vault-75e984b5.bdecd756.z1.hashicorp.cloud:8200";
            String username = "espire_dev";
            String password = "Dev+Cred4#";
            String namespace = "admin/espire";
            String secretPath = "Store_Dev/10099";

            // First: authenticate and get token
            VaultConfig loginConfig = new VaultConfig()
                    .address(vaultUrl)
                    .nameSpace(namespace)
                    .build();

            Vault vaultForLogin = new Vault(loginConfig);
            AuthResponse authResponse = vaultForLogin.auth().loginByUserPass(username, password, "userpass");
            String clientToken = authResponse.getAuthClientToken();

            // Then: use token in full config
            VaultConfig configWithToken = new VaultConfig()
                    .address(vaultUrl)
                    .token(clientToken)
                    .nameSpace(namespace)
                    .build();

            Vault vault = new Vault(configWithToken);
            LogicalResponse response = vault.logical().read("Store_Dev/10099");

            Map<String, String> secretData = response.getData();
            String passwordValue = secretData.get("password");
            System.out.println("Retrieved secret password: " + passwordValue);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
